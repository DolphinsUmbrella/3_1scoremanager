DROP TABLE IF EXISTS SCHOOL;

CREATE TABLE SCHOOL(
CD CHAR(3) PRIMARY KEY NOT NULL,
NAME VARCHAR(20) NOT NULL UNIQUE
);

DROP TABLE IF EXISTS CLASS_NUM;

CREATE TABLE CLASS_NUM(
SCHOOL_CD CHAR(3) NOT NULL,
CLASS_NUM VARCHAR(5) NOT NULL,

PRIMARY KEY (SCHOOL_CD, CLASS_NUM),
FOREIGN KEY (SCHOOL_CD) REFERENCES SCHOOL(CD)
);

DROP TABLE IF EXISTS STUDENT;

CREATE TABLE STUDENT(
NO VARCHAR(10) PRIMARY KEY NOT NULL,
NAME VARCHAR(10) NOT NULL,
ENT_YEAR INTEGER(10),
CLASS_NUM CHAR(3) NOT NULL,
IS_ATTEND BOOLEAN NOT NULL,
SCHOOL_CD CHAR(3) NOT NULL,

FOREIGN KEY (CLASS_NUM) REFERENCES CLASS_NUM(CLASS_NUM),
FOREIGN KEY (SCHOOL_CD) REFERENCES SCHOOL(CD)
);

DROP TABLE IF EXISTS TEACHER;

CREATE TABLE TEACHER(
ID VARCHAR(10) PRIMARY KEY NOT NULL,
PASSWORD VARCHAR(30) NOT NULL,
NAME VARCHAR(10) NOT NULL,
SCHOOL_CD CHAR(3) NOT NULL,

FOREIGN KEY (SCHOOL_CD) REFERENCES SCHOOL(CD)
);

DROP TABLE IF EXISTS SUBJECT;

CREATE TABLE SUBJECT(
SCHOOL_CD CHAR(3) NOT NULL,
CD CHAR(3) NOT NULL,
NAME VARCHAR(20) NOT NULL UNIQUE,

PRIMARY KEY (SCHOOL_CD, CD),
FOREIGN KEY (SCHOOL_CD) REFERENCES SCHOOL(CD)
);

DROP TABLE IF EXISTS TEST;

CREATE TABLE TEST(
STUDENT_NO VARCHAR(10) NOT NULL,
SUBJECT_CD CHAR(3) NOT NULL,
SCHOOL_CD CHAR(10) NOT NULL,
NO INTEGER(10) NOT NULL,
POINT INTEGER(10),
CLASS_NUM VARCHAR(5) NOT NULL,

PRIMARY KEY (STUDENT_NO, SUBJECT_CD, SCHOOL_CD, NO),
FOREIGN KEY (STUDENT_NO) REFERENCES STUDENT(NO),
FOREIGN KEY (SUBJECT_CD) REFERENCES SUBJECT(CD),
FOREIGN KEY (SCHOOL_CD) REFERENCES SCHOOL(CD),
FOREIGN KEY (CLASS_NUM) REFERENCES CLASS_NUM(CLASS_NUM)
);

INSERT INTO SCHOOL(CD, NAME) VALUES
('tes', 'テスト校');

INSERT INTO CLASS_NUM(SCHOOL_CD, CLASS_NUM) VALUES
('tes', '101'),
('tes', '102'),
('tes', '201'),
('tes', '202');


INSERT INTO TEACHER(ID, PASSWORD, NAME, SCHOOL_CD) VALUES
('admin1', 'password', '管理者1', 'tes');


INSERT INTO STUDENT (NO, NAME, ENT_YEAR, CLASS_NUM, IS_ATTEND, SCHOOL_CD)
VALUES
    (124, 'bbb', 2024, 102, FALSE, 'tes'),
    (125, 'ccc', 2025, 201, TRUE, 'tes'),
    (126, 'ddd', 2025, 202, FALSE, 'tes'),
    (127, '大原太郎', 2025, 202, FALSE, 'tes'),
    (128, 'eeee', 2023, 101, TRUE, 'tes'),
    (129, 'ffff', 2023, 102, TRUE, 'tes'),
    (130, 'gggg', 2024, 201, FALSE, 'tes'),
    (131, 'hhhh', 2024, 202, TRUE, 'tes'),
    (132, 'iiii', 2025, 101, FALSE, 'tes'),
    (133, 'jjjj', 2025, 102, TRUE, 'tes'),
    (134, 'kkkk', 2023, 201, FALSE, 'tes'),
    (135, 'llll', 2023, 202, TRUE, 'tes'),
    (136, 'mmmm', 2024, 101, FALSE, 'tes'),
    (137, 'nnnn', 2024, 102, TRUE, 'tes'),
    (138, 'oooo', 2025, 201, FALSE, 'tes'),
    (139, 'pppp', 2025, 202, TRUE, 'tes'),
    (140, 'qqqq', 2023, 101, FALSE, 'tes'),
    (141, 'rrrr', 2023, 102, TRUE, 'tes'),
    (142, 'ssss', 2024, 201, TRUE, 'tes'),
    (143, 'tttt', 2024, 202, FALSE, 'tes');

INSERT INTO SUBJECT (SCHOOL_CD, CD, NAME)
VALUES
    ('tes', '101', 'python'),
    ('tes', '102', 'java'),
    ('tes', '103', 'js');

INSERT INTO TEST (STUDENT_NO, SUBJECT_CD, SCHOOL_CD, NO, POINT, CLASS_NUM)
VALUES
    (124, '101', 'tes', 1, 90, '102'),
    (124, '101', 'tes', 2, 95, '102'),
    (124, '102', 'tes', 1, 80, '102'),
    (124, '102', 'tes', 2, 90, '102'),
    (124, '103', 'tes', 1, 65, '102'),
    (124, '103', 'tes', 2, 75, '102'),
    (125, '101', 'tes', 1, 60, '201'),
    (125, '101', 'tes', 2, 80, '201'),
    (125, '102', 'tes', 1, 65, '201'),
    (125, '102', 'tes', 2, 70, '201'),
    (125, '103', 'tes', 1, 70, '201'),
    (125, '103', 'tes', 2, 55, '201'),